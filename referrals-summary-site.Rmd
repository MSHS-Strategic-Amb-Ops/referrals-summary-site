---
output:
  html_document:
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
    fig_width: 7
    fig_height: 6
---


<style type="text/css">
div.main-container {
  max-width: 2000px;
  margin-left: 0;
  margin-right: auto;
}
</style>

<style>
.tocify {
color: black;
}
<!-- } -->
<!-- .tocify .tocify-header { -->
<!--     position: fixed; -->
<!--     <!-- top: 50px; --> -->
<!--     left: 50px; -->
<!--     width: 350px; -->
<!--     <!-- border: solid 3px black; --> -->
<!--     <!-- height: 200px; --> -->
<!--  border: none; -->
<!-- } -->
.tocify .tocify-header .active {
color: white;
background: #d80b8c;
font-weight: bold;
}
<!-- .tocify .tocify-item { -->
<!-- background: white; -->
<!-- color: black; -->
<!--  border: none; -->
<!-- } -->
</style>


<style>
  .nav-pills>li>a:hover, .nav-pills>li>a:focus, .nav-pills>li.active>a,     .nav-pills>li.active>a:hover, .nav-pills>li.active>a:focus{
     background-color: #210070;
     }
</style>

<style>
.container { width: 1800px; }
h2 {
  background-color: #dddedd;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h3 {
  background-color: #f2f2f2;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h4 {
  <!-- background-color: #dddedd; -->
  <!-- color: black; -->
  text-indent: 50px;
  <!-- font-weight: bold; -->
}
</style>

<style>
.blackbox {
  padding: 1em;
  background: white;
  color: black;
  border: 2px solid #7f7f7f;
  width: 100%;
  position: center;
  align: center;
  margin: 0px auto;
}
.center {
  text-align: left;
  margin: 0px auto;
}
</style>


<!-- ```{css toc-content, echo = FALSE} -->
<!-- #TOC { -->
<!--   right: 270px; -->
<!--   margin: 20px 0px 25px 0px; -->
<!-- } -->

<!-- .main-container { -->
<!--     margin-left: 200px; -->
<!-- } -->
<!-- ``` -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r Load Packages, echo = FALSE, warning = FALSE, message = FALSE}

# # Load packages -----------------------------------------------------------------------------------
suppressMessages({
  memory.limit(size = 8000000)
  library(readxl)
  library(writexl)
  library(plyr)
  library(dplyr)
  library(data.table)
  library(zoo)
  library(shiny)
  library(shinydashboard)
  library(shinydashboardPlus)
  library(shinyWidgets)
  library(htmlwidgets)
  library(lubridate)
  library(tcltk)
  library(tidyverse)
  library(plotly)
  library(knitr)
  library(kableExtra)
  library(leaflet)
  library(grid)
  library(gridExtra)
  library(eeptools)
  library(ggQC)
  library(zipcodeR)
  library(utils)
  library(scales)
  library(chron)
  library(bupaR)
  library(shiny)
  library(DT)
  library(DiagrammeR)
  library(shinyalert)
  library(edeaR)
  library(processmapR)
  library(processmonitR)
  library(processanimateR)
  library(tidyr)
  library(lubridate)
  library(RColorBrewer)
  library(DiagrammeR)
  library(ggplot2)
  library(leaflet)
  library(readr)
  library(highcharter)
  library(ggforce) # for 'geom_arc_bar'
  library(packcircles) # for packed circle graph
  library(viridis)
  library(ggiraph)
  library(treemapify)
  library(treemap)
  library(broom)
  library(extrafont)
  library(tis) # for US holidays
  library(vroom)
  library(sjmisc)
  library(tools)
  library(here)
  library(shinyBS)
  library(shinyscreenshot)
  library(fasttime)
  library(shinycssloaders)
  library(feather)
  # library(zipcodeR)
  library(formattable)
  library(shinyjs)
  library(janitor)
  library(patchwork)
  library(flexdashboard)
  # library(tidyverse)
  # library(viridis)
  # library(hrbrthemes)
  # library(plotly)
  # install.packages("bsts")
  library(bsts)
  library(reactable)
  # install.packages("reactablefmtr")
  library(reactablefmtr)
  library(svDialogs)
  # library(openxlsx)
  library(flextable)
  library(officedown)
  library(officer)
  library(magrittr)
  library(webshot) 
  library(png)
  library(ggh4x)
  library(RODBC)
  library(DBI)
  library(odbc)
  library(dbplyr)
  library(pool)
  library(emojifont)
})


```


```{r Graph asthetics, echo = FALSE, warning = FALSE, message = FALSE}
### Color Functions for Graphs ============================================================

# Mount Sinai corporate colors "USE THIS TO ADD COLORS"
MountSinai_colors <- c(
  `dark purple`  = "#210070",
  `dark pink`    = "#d80b8c",
  `dark blue`    = "#00aeef",
  `dark grey`    = "#7f7f7f",
  `yellow`       = "#ffc000",
  `purple`       = "#7030a0",
  `med purple`   = "#5753d0",
  `med pink`     = "#f75dbe",
  `med blue`     = "#5cd3ff",
  `med grey`     = "#a5a7a5",
  `light purple` = "#c7c6ef",
  `light pink`   = "#fcc9e9",
  `light blue`   = "#c9f0ff",
  `light grey`   = "#dddedd"
  )

# Function to extract Mount Sinai colors as hex codes
# Use Character names of MountSinai_colors

MountSinai_cols <- function(...) {
  cols <- c(...)
  
  if (is.null(cols))
    return (MountSinai_colors)
  
  MountSinai_colors[cols]
}

# Color Function that can be used to call all colors is "MountSinai_cols()"
# Use in ggplot 

  #MountSinai_cols()       # will provide all colors and their hex codes in a table 
  #MountSinai_cols("pink") # will provide color name and the hex code for the pink color

# Create palettes 
MountSinai_palettes <- list(
  `all`   = MountSinai_cols("dark purple","dark pink","dark blue","dark grey",
                            "med purple","med pink","med blue","med grey", 
                            "light purple","light pink","light blue","light grey"),
  
  `main`  = MountSinai_cols("dark purple","dark pink","dark blue","dark grey"),
  
  `purple`  = MountSinai_cols("dark purple","med purple","light purple"),
  
  `pink`  = MountSinai_cols("dark pink","med pink","light pink"),
  
  `blue`  = MountSinai_cols("dark blue", "med blue", "light blue"),
  
  `grey`  = MountSinai_cols("dark grey", "med grey", "light grey"),
  
  `purpleGrey` = MountSinai_cols("dark purple", "dark grey"),
  
  `pinkBlue` = MountSinai_cols("dark pink", "dark blue")
  
)

# MountSinai_palettes
# Return function to interpolate a Mount Sinai color palette
# default value is the main palette, reverse = True will change the order

MountSinai_pal <- function(palette = "all", reverse = FALSE, ...) {
  pal <- MountSinai_palettes[[palette]]
  
  if (reverse) pal <- rev(pal)
  
  colorRampPalette(pal, ...)
}



# Scale Function for ggplot can be used instead of scale_color_manual
scale_color_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)
  
  if (discrete) {
    discrete_scale("colour", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_color_gradientn(colours = pal(256), ...)
  }
}

# Scale Fill for ggplot insetead of scale_fill_manual 
scale_fill_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)

  if (discrete) {
    discrete_scale("fill", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_fill_gradientn(colours = pal(256), ...)
  }
}

# Use in ggplot 
  # scale_color_MountSinai("main")

```


```{r Global Functions, echo = FALSE, warning = FALSE, message = FALSE}

'%!in%' <- function(x,y)!('%in%'(x,y)) # Does not include
not_all_na <- function(x) all(!is.na(x)) # Exclude columns with All NAs

```


```{r Import Scheduling Data, echo = FALSE, warning = FALSE, message = FALSE}

scheduling_data_raw <- as.data.frame(readRDS("/nfs/data/Applications/Ambulatory/Data_Updated/historical_data.rds")) %>%
  mutate(Campus = ifelse(Campus == "MSDD", "MSDMG", Campus)) %>%
  filter(!is.na(Campus)) %>%
  filter(Campus %in% c("NETWORK","MSM","MSH-MSDFP","ONCOLOGY","MSW","MSBI","MSUS","MSH- AMBULATORY CARE","MSDMG", "MSHP"))


# scheduling_data_raw <- as.data.frame(readRDS("historical_data.rds")) %>%
#   mutate(Campus = ifelse(Campus == "MSDD", "MSDMG", Campus)) %>%
#   filter(!is.na(Campus)) %>%
#   filter(Campus %in% c("NETWORK","MSM","MSH-MSDFP","ONCOLOGY","MSW","MSBI","MSUS","MSH- AMBULATORY CARE","MSDMG","MSHP"))


scheduling_data_raw <- scheduling_data_raw %>%
  mutate(New.PT2 = case_when(New.PT2 == "New" ~ 'New',TRUE ~ 'Established'),
         Appt.Made.DateYear = as.Date(Appt.Made.DTTM, format="%Y-%m-%d"),
         Appt.Made.MonthYear = format(as.Date(Appt.Made.DTTM, format="%m/%d/%Y"), "%Y-%m"),
         Appt.Made.Year = format(as.Date(Appt.Made.DTTM, format="%m/%d/%Y"), "%Y"),
         Appt.Cancel.DateYear = as.Date(Appt.Cancel.DTTM, format="%Y-%m-%d")) %>%
  mutate(Appt.Status = case_when(Appt.Status == "Canceled" & Appt.DateYear == Appt.Cancel.DateYear ~ "Same-Day Canceled",
                                 TRUE ~ Appt.Status)) %>%
  mutate(Visit.Method = ifelse(str_detect(Visit.Method, "PERSON"),"inPerson","telehealth"))

scheduling_data_raw <- scheduling_data_raw %>%
  mutate(Appt.MonthNum = format(as.Date(Appt.DateYear, format="%Y-%m-%d"), "%m"),
         Appt.Made.MonthNum = format(as.Date(Appt.Made.DateYear, format="%Y-%m-%d"), "%m"))

```


```{r Reporting Variables, echo = FALSE, warning = FALSE, message = FALSE}

report_run_date <- Sys.Date()
# report_run_date <- "2022-08-10"
reporting_week <- floor_date(as.Date(report_run_date, "%Y-%m-%d")-7, unit="week", week_start = 7)
reporting_week_prior <- floor_date(as.Date(report_run_date, "%Y-%m-%d")-14, unit="week", week_start = 7)
reporting_week_next <- floor_date(as.Date(report_run_date, "%Y-%m-%d"), unit="week", week_start = 7)

reporting_year <- format(as.Date(report_run_date), "%Y")
reporting_month <- format(as.Date(report_run_date), "%b")
reporting_monthNum <- format(as.Date(report_run_date), "%m")


max_appt_date <- max((scheduling_data_raw %>% filter(Appt.Status == "Arrived"))$Appt.DateYear)
max_appt_date <- report_run_date -1

full_month <- format((lubridate::floor_date(max_appt_date, unit = "month")-1), "%B")
full_monthNum <- format((lubridate::floor_date(max_appt_date, unit = "month")-1), "%m")
full_monthYear <- format((lubridate::floor_date(max_appt_date, unit = "month")-1), "%m-%Y")
full_yearMonth <- format((lubridate::floor_date(max_appt_date, unit = "month")-1), "%Y-%m")
full_monthYear_label <- format((lubridate::floor_date(max_appt_date, unit = "month")-1), "%b-%Y")

current_month <- format((lubridate::floor_date(max_appt_date, unit = "month")), "%B")
current_monthNum <- format((lubridate::floor_date(max_appt_date, unit = "month")), "%m")
current_monthYear <- format((lubridate::floor_date(max_appt_date, unit = "month")), "%m-%Y")
current_yearMonth <- format((lubridate::floor_date(max_appt_date, unit = "month")), "%Y-%m")
current_monthYear_label <- format((lubridate::floor_date(max_appt_date, unit = "month")), "%b-%Y")


```


```{r Scheduling Data Processing, echo = FALSE, warning = FALSE, message = FALSE}

# Access
# Access by Site, Specialty, Department --------------------------------------------------------
## Site
waitTime_site_specialty_dept_180days <- scheduling_data_raw %>%
  filter(Wait.Time >= 0) %>%
  filter(Appt.Made.DateYear < report_run_date & Appt.Made.DateYear >= report_run_date - 180) %>%
  filter(New.PT2 == "New") %>%
  group_by(Campus.Specialty, Campus, Department, DepartmentId) %>%
  summarise(med_wait = as.numeric(median(Wait.Time, na.rm = TRUE)))

waitTime_site_specialty_dept_trend <- scheduling_data_raw %>%
  filter(Wait.Time >= 0) %>%
  filter(New.PT2 == "New") %>%
  group_by(Campus.Specialty, Campus, Department, DepartmentId, Appt.Made.MonthYear, Appt.Made.MonthNum) %>%
  summarise(med_wait = as.numeric(median(Wait.Time, na.rm = TRUE)))

# New Patients Scheduled <14 Days
# Percent of New Patients Scheduled within 14 Days by Provider -----------------
new_access_site_specialty_dept_180days <- scheduling_data_raw %>%
  filter(Wait.Time >= 0) %>%
  filter(Appt.Made.DateYear < report_run_date & Appt.Made.DateYear >= report_run_date - 180) %>%
  filter(New.PT2 == "New") %>%
  mutate(waitTime_14days = case_when(Wait.Time <= 14 ~ "Yes",
                                    TRUE ~ "No")) %>%
  group_by(Campus.Specialty, Campus, Department,  DepartmentId, waitTime_14days) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = waitTime_14days,
              values_from = total,
              values_fill = 0) %>%
  mutate(perc_14days = Yes/(Yes+No))


new_access_site_specialty_dept_trend <- scheduling_data_raw %>%
  filter(Wait.Time >= 0) %>%
  filter(New.PT2 == "New") %>%
  mutate(waitTime_14days = case_when(Wait.Time <= 14 ~ "Yes",
                                    TRUE ~ "No")) %>%
  group_by(Campus.Specialty, Campus, Department,  DepartmentId, Appt.Made.MonthYear, Appt.Made.MonthNum, waitTime_14days) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = waitTime_14days,
              values_from = total,
              values_fill = 0) %>%
  mutate(perc_14days = Yes/(Yes+No))



# Volume by Provider -----------------------------------------------------------
volume_site_specialty_dept_180days <- scheduling_data_raw %>%
  filter(Appt.Status == "Arrived") %>%
  filter(Appt.DateYear < report_run_date & Appt.DateYear >= report_run_date - 180) %>%
  group_by(Campus.Specialty, Campus, Department,  DepartmentId, New.PT2) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = New.PT2,
              values_from = total,
              values_fill = 0) %>%
  mutate(total = New + Established,
         new_perc = New/(total))


volume_site_specialty_dept_trend <- scheduling_data_raw %>%
  filter(Appt.Status == "Arrived") %>%
  group_by(Campus.Specialty, Campus, Department,  DepartmentId, Appt.MonthYear, Appt.MonthNum, New.PT2) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = New.PT2,
              values_from = total,
              values_fill = 0) %>%
  mutate(total = New + Established,
         new_perc = New/(total))


volume_site_specialty_dept_total <- scheduling_data_raw %>%
  filter(Appt.Status == "Arrived") %>%
  filter(Appt.DateYear < report_run_date & Appt.DateYear >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
  group_by(Campus.Specialty, Campus, Department,  DepartmentId, New.PT2) %>%
  summarise(total = n()) %>%
  pivot_wider(names_from = New.PT2,
              values_from = total,
              values_fill = 0) %>%
  mutate(total = New + Established,
         new_perc = New/(total))


# saveRDS(waitTime_site_specialty_dept_180days, "waitTime_site_specialty_dept_180days.rds")
# saveRDS(waitTime_site_specialty_dept_trend, "waitTime_site_specialty_dept_trend.rds")
# saveRDS(new_access_site_specialty_dept_180days, "new_access_site_specialty_dept_180days.rds")
# saveRDS(new_access_site_specialty_dept_trend, "new_access_site_specialty_dept_trend.rds")
# saveRDS(volume_site_specialty_dept_180days, "volume_site_specialty_dept_180days.rds")
# saveRDS(volume_site_specialty_dept_trend, "volume_site_specialty_dept_trend.rds")
# saveRDS(volume_site_specialty_dept_trend, "volume_site_specialty_dept_total.rds")

# waitTime_site_specialty_dept_180days <- readRDS("waitTime_site_specialty_dept_180days.rds")
# waitTime_site_specialty_dept_trend <- readRDS("waitTime_site_specialty_dept_trend.rds")
# new_access_site_specialty_dept_180days <- readRDS("new_access_site_specialty_dept_180days.rds")
# new_access_site_specialty_dept_trend <- readRDS("new_access_site_specialty_dept_trend.rds")
# volume_site_specialty_dept_180days <- readRDS("volume_site_specialty_dept_180days.rds")
# volume_site_specialty_dept_trend <- readRDS("volume_site_specialty_dept_trend.rds")
# volume_site_specialty_dept_total <- readRDS("volume_site_specialty_dept_total.rds")


```


```{r Scheduling Data Processing by Specialty, echo = FALSE, warning = FALSE, message = FALSE}

# conn1 <- dbPool(drv = odbc(), dsn = "Caboodle", timeout = 30)
# 
# # Import Referrals+Visit Data --------------------------------------------------
# referrals_conn <- tbl(conn1, "Referrals")
# referrals_depts <- referrals_conn %>%
#   mutate(StartInstant = as.Date(StartInstant)) %>%
#   filter(StartInstant >= as.Date("2022-04-01") & StartInstant <= report_run_date) %>%
#   filter(Status != "Canceled") %>%
#   group_by(ReceivedByDept, ReceivedByDepID) %>%
#   summarise(total = n()) %>%
#   collect() %>%
#   dplyr::select(-total)

```



```{r Import Processed Referrals Volume Data, echo = FALSE, warning = FALSE, message = FALSE}

path <- "/nfs/data/Applications/Ambulatory/Data_Updated/"
# saveRDS(referral_vol, paste0(path,"referral_vol.rds"))

referral_vol <- readRDS(paste0(path,"referral_vol.rds"))
# referral_vol <- readRDS("referral_vol (1).rds")

```



```{r Graph and Table Functions, echo = FALSE, warning = FALSE, message = FALSE, results='hide'}

# Creating Data Bars for Reactable ---------------------------------------------
 library(htmltools)
  bar_style <- function(width = 1, fill = "#e6e6e6", height = "75%",
                      align = c("left", "right"), color = NULL) {
  align <- match.arg(align)
  if (align == "left") {
    position <- paste0(width * 100, "%")
    image <- sprintf("linear-gradient(90deg, %1$s %2$s, transparent %2$s)", fill, position)
  } else {
    position <- paste0(100 - width * 100, "%")
    image <- sprintf("linear-gradient(90deg, transparent %1$s, %2$s %1$s)", position, fill)
  }
  list(
    backgroundImage = image,
    backgroundSize = paste("100%", height),
    backgroundRepeat = "no-repeat",
    backgroundPosition = "center",
    color = color
  )
  }
  
# Creating Value Boxes (3 per row) ---------------------------------------------
  createValueBoxes <- function(df, box_color, h = 8, w = 14, padding=0.5, rows = 2){
  # required packages
  library(ggplot2)
  library(emojifont)
  # verify our inputs
  if (!is.data.frame(df)) {
    stop(paste("Argument", deparse(substitute(df)), "must be a data.frame."))
    }
  if(!all(i <- rlang::has_name(df,c("values", "infos", "icons")))){
    stop(sprintf(
      "%s does not contain: %s",
      deparse(substitute(df)),
      paste(columns[!i], collapse=", ")))
  }
  
  boxes = nrow(df) # number of items passed
  # calculate the grid
  cols = boxes/rows
  plotdf <- data.frame(
    x = rep(seq(0, (w+padding)*cols-1, w+padding), times=rows),
    y = rep(seq(0, (h+padding)*rows-1, h+padding), each=cols),
    h = rep(h, boxes),
    w = rep(w, boxes),
    value = df$values,
    info = df$infos,
    icon = fontawesome(df$icons),
    font_family = c(rep("fontawesome-webfont", boxes)),
    color = factor(1:boxes)
  )
  print(plotdf)
  ggplot(plotdf, aes(x, y, height = h, width = w, label = info)) +
    ## Create the tiles using the `color` column
    geom_tile(aes(fill = color)) +
    ## Add the numeric values as text in `value` column
    geom_text(color = "white", fontface = "bold", size = 18,
              aes(label = value, x = x - w/2.2, y = y + h/4), hjust = 0) +
    ## Add the labels for each box stored in the `info` column
    geom_text(color = "white", fontface = "bold", size = 12,
              aes(label = info, x = x - w/2.2, y = y-h/4), hjust = 0) +
    coord_fixed() +
    scale_fill_manual(values = c(rep(box_color,3)))+
    ## Use `geom_text()` to add the icons by specifying the unicode symbol.
    geom_text(size = 24, aes(label = icon, family = font_family,
                             x = x + w/4, y = y + h/8), alpha = 0.25) +
    theme_void() +
    guides(fill = FALSE)
  
  } 
  
  
  # Creating Value Boxes (2 per row) ---------------------------------------------
  createValueBoxes_2boxes <- function(df, box_color, h = 8, w = 14, padding=0.5, rows = 2){
  # required packages
  library(ggplot2)
  library(emojifont)
  # verify our inputs
  if (!is.data.frame(df)) {
    stop(paste("Argument", deparse(substitute(df)), "must be a data.frame."))
    }
  if(!all(i <- rlang::has_name(df,c("values", "infos", "icons")))){
    stop(sprintf(
      "%s does not contain: %s",
      deparse(substitute(df)),
      paste(columns[!i], collapse=", ")))
  }
  
  boxes = nrow(df) # number of items passed
  # calculate the grid
  cols = boxes/rows
  plotdf <- data.frame(
    x = rep(seq(0, (w+padding)*cols-1, w+padding), times=rows),
    y = rep(seq(0, (h+padding)*rows-1, h+padding), each=cols),
    h = rep(h, boxes),
    w = rep(w, boxes),
    value = df$values,
    info = df$infos,
    icon = fontawesome(df$icons),
    font_family = c(rep("fontawesome-webfont", boxes)),
    color = factor(1:boxes)
  )
  print(plotdf)
  ggplot(plotdf, aes(x, y, height = h, width = w, label = info)) +
    ## Create the tiles using the `color` column
    geom_tile(aes(fill = color)) +
    ## Add the numeric values as text in `value` column
    geom_text(color = "white", fontface = "bold", size = 18,
              aes(label = value, x = x - w/2.2, y = y + h/4), hjust = 0) +
    ## Add the labels for each box stored in the `info` column
    geom_text(color = "white", fontface = "bold", size = 12,
              aes(label = info, x = x - w/2.2, y = y-h/4), hjust = 0) +
    coord_fixed() +
    scale_fill_manual(values = c(rep(box_color,3)))+
    ## Use `geom_text()` to add the icons by specifying the unicode symbol.
    geom_text(size = 24, aes(label = icon, family = font_family,
                             x = x + w/4, y = y + h/8), alpha = 0.25) +
    theme_void() +
    guides(fill = FALSE)
  
  } 

# Formatting Dollar/big Number Values -------------------------------------------
  comprss <- function(tx) { 
      div <- findInterval(as.numeric(gsub("\\,", "", tx)), 
         c(0, 1e3, 1e6, 1e9, 1e12) )  # modify this if negative numbers are possible
      paste(round( as.numeric(gsub("\\,","",tx))/10^(3*(div-1)), 2), 
           c("","K","M","B","T")[div] )}
  
# Reactable Conditional Formatting ---------------------------------------------
  
  make_color_pal <- function(colors, bias = 1) {
  get_color <- colorRamp(colors, bias = bias)
  function(x) rgb(get_color(x), maxColorValue = 255)
  }
  
  pct_colorGn <- make_color_pal(c("#ffffff", "#f2fbd2", "#c9ecb4", "#93d3ab", "#35b0ab"), bias = 2)
  pct_color_GnRd <- make_color_pal(c("#fd84a9", "white", "#85e085"), bias = 2)

```


```{r Sinai Logo, echo=FALSE, out.width = '20%'}
knitr::include_graphics("Mount_Sinai_Logo_H.png")
```


```{r}

# 
# test <- referrals_vol %>%
#   filter(CreationToScheduledDate > 0) %>%
#   filter(referred)
# 
# hchart(test,type = "scatter",
#        hcaes(x = CreationToScheduledDate, y = CreationToFirstEncounterDate),
#        showInLegend = FALSE) %>%
#   hc_tooltip(pointFormat = "height: {point.y} <br> weight: {point.x}")


```


```{r YTD Referrals Volume Received, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12}

# MSHS -------------------------------------------------------------------------
mshs_sites <- c("MSBI", "MSDMG", "MSH- Ambulatory Care", "MSH-MSDFP", 
                         "MSM", "MSUS", "MSW", "Network", "Oncology")
  
  # Referrals Received Data 
  referral_vol_site_data_mshs <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(ReceivedBySite %in% mshs_sites) %>%
    filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
    group_by(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  # referral_vol_urgent_site_data_mshs <- referral_vol_site_data_mshs %>%
  #   filter(ApptStatusFinal == "Pending") %>%
  #   filter(priority_type == "Within 2 Days") %>%
  #   group_by(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID) %>%
  #   summarise(urgent_vol = n())
  
  referral_vol_site_data_mshs <- referral_vol_site_data_mshs %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  # Volume Last 3 Months
  referral_vol_site_data_mshs$total_vol <- volume_site_specialty_dept_180days$total[match(referral_vol_site_data_mshs$ReceivedByDepID, volume_site_specialty_dept_180days$DepartmentId)]
  
  referral_vol_site_data_mshs <- referral_vol_site_data_mshs %>%
    adorn_totals("row", name = "MSHS Total") %>%
    mutate(conversion_rate = round((Total - Pending)/Total,2),
           completion_rate = round(Arrived/Total,2)) %>%
    dplyr::select(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, Total, Arrived,  Pending, conversion_rate, completion_rate, total_vol)
  
  # New PT Volume Last 3 Months
  referral_vol_site_data_mshs$new_pts <- volume_site_specialty_dept_180days$new_perc[match(referral_vol_site_data_mshs$ReceivedByDepID, volume_site_specialty_dept_180days$DepartmentId)]
  
  # Median New Wait Time Last 3 Months
  referral_vol_site_data_mshs$new_access <- waitTime_site_specialty_dept_180days$med_wait[match(referral_vol_site_data_mshs$ReceivedByDepID, waitTime_site_specialty_dept_180days$DepartmentId)]
  
  # New Patients Scheduled Last 3 Months
  referral_vol_site_data_mshs$new_14access_perc <- new_access_site_specialty_dept_180days$perc_14days[match(referral_vol_site_data_mshs$ReceivedByDepID, new_access_site_specialty_dept_180days$DepartmentId)]
  
  referral_vol_site_data_mshs$ReceivedByDepID <- NULL
  
  
  # Referrals Sent Data -------------------------------------------------------
  

# Site Breakdown Function ------------------------------------------------------
received_vol_site_ytd <- function(site){
  
  # Referrals Data 
  referral_vol_site_data <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(ReceivedBySite == site) %>%
    filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
    group_by(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  referral_vol_site_data <- referral_vol_site_data %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  
  # Volume Last 3 Months
  referral_vol_site_data$total_vol <- volume_site_specialty_dept_180days$total[match(referral_vol_site_data$ReceivedByDepID, volume_site_specialty_dept_180days$DepartmentId)]
  
  referral_vol_site_data <- referral_vol_site_data %>%
    adorn_totals("row", name = paste(site, "Total")) %>%
    mutate(conversion_rate = round((Total - Pending)/Total,2),
           completion_rate = round(Arrived/Total,2)) %>%
    dplyr::select(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, Total, Arrived,  Pending, conversion_rate, completion_rate, total_vol)
  
  # New PT Volume Last 3 Months
  referral_vol_site_data$new_pts <- volume_site_specialty_dept_180days$new_perc[match(referral_vol_site_data$ReceivedByDepID, volume_site_specialty_dept_180days$DepartmentId)]
  
  # Median New Wait Time Last 3 Months
  referral_vol_site_data$new_access <- waitTime_site_specialty_dept_180days$med_wait[match(referral_vol_site_data$ReceivedByDepID, waitTime_site_specialty_dept_180days$DepartmentId)]
  
  # New Patients Scheduled Last 3 Months
  referral_vol_site_data$new_14access_perc <- new_access_site_specialty_dept_180days$perc_14days[match(referral_vol_site_data$ReceivedByDepID, new_access_site_specialty_dept_180days$DepartmentId)]
  
  referral_vol_site_data$ReceivedByDepID <- NULL
  
  return(referral_vol_site_data)
}
  
  
  
  # Site Breakdown Function ------------------------------------------------------
sending_vol_site_ytd <- function(site){
  
  # site <- "MSHP"
  # Referrals Data 
  referral_sending_vol_site_data <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(SentBySite != "*Unspecified") %>%
    filter(SentBySpecialty != "*Unspecified") %>%
    filter(SentBySite == site) %>%
    filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
    group_by(SentBySpecialty, SentByDept, SentByDepID, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  # Add Missing ApptStatusFinal
  nms <- c("SentBySpecialty", "SentByDept", "SentByDepID", 
          "Pending", "Arrived", "Canceled", "Scheduled", "No Show")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(referral_sending_vol_site_data))  # Find names of missing columns
  referral_sending_vol_site_data[Missing] <- 0                    # Add them, filled with '0's
  referral_sending_vol_site_data<- referral_sending_vol_site_data[nms]     
  
  
  referral_sending_vol_site_data <- referral_sending_vol_site_data %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  
  # Total Visit Volume 
  referral_sending_vol_site_data$total_vol <- volume_site_specialty_dept_total$total[match(referral_sending_vol_site_data$SentByDepID, volume_site_specialty_dept_total$DepartmentId)]
  referral_sending_vol_site_data$total_vol[is.na(referral_sending_vol_site_data$total_vol)] <- 0
  
  referral_sending_vol_site_data <- referral_sending_vol_site_data %>%
    adorn_totals("row", name = paste(site, "Total"))
    
  referral_sending_vol_site_data <- referral_sending_vol_site_data %>%
    mutate(avg_referrals = round(Total/total_vol,2),
           conversion_rate = round((Total - Pending)/Total,2),
           completion_rate = round(Arrived/Total,2)) %>%
    dplyr::select(SentBySpecialty, SentByDept, SentByDepID, Total, Arrived,  Pending, total_vol, avg_referrals, conversion_rate, completion_rate)
  
  referral_sending_vol_site_data$SentByDepID <- NULL
  
  return(referral_sending_vol_site_data)
}
  

```



```{r Last Month Referrals Volume Received, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12}

# MSHS Current and Last Year ----------------------------------------------------
referral_vol_site_data_mshs_month <- function(monthYear, yearMonth){
  
  mshs_sites <- c("MSBI", "MSDMG", "MSH- Ambulatory Care", "MSH-MSDFP", 
                  "MSM", "MSUS", "MSW", "Network", "Oncology")
  
  # Referrals Data 
  referral_vol_site_data_month_mshs <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(ReceivedBySite %in% mshs_sites) %>%
    filter(createdMonthYear == monthYear) %>%
    group_by(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  
  referral_vol_site_data_month_mshs <- referral_vol_site_data_month_mshs %>%
    mutate(Total = sum(across(where(is.numeric)))) 
    
  # Scheduling Data Filtered to Full Month 
  volume_site_specialty_dept_month <- volume_site_specialty_dept_trend %>% filter(Appt.MonthYear == yearMonth)
  waitTime_site_specialty_dept_trend_month <- waitTime_site_specialty_dept_trend %>% filter(Appt.Made.MonthYear == yearMonth)
  new_access_site_specialty_dept_month <- new_access_site_specialty_dept_trend %>% filter(Appt.Made.MonthYear == yearMonth)
  
  # Volume Last 3 Months
  referral_vol_site_data_month_mshs$total_vol <- volume_site_specialty_dept_month$total[match(referral_vol_site_data_month_mshs$ReceivedByDepID, volume_site_specialty_dept_month$DepartmentId)]
  
  referral_vol_site_data_month_mshs <- referral_vol_site_data_month_mshs %>%
    adorn_totals("row", name = "MSHS Total") %>%
    mutate(conversion_rate = round((Total - Pending)/Total,2),
           completion_rate = round(Arrived/Total,2)) %>%
    dplyr::select(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, Total, Arrived,  Pending, conversion_rate, completion_rate, total_vol)
  
  # New PT Volume Last 3 Months
  referral_vol_site_data_month_mshs$new_pts <- volume_site_specialty_dept_month$new_perc[match(referral_vol_site_data_month_mshs$ReceivedByDepID, volume_site_specialty_dept_month$DepartmentId)]
  
  # Median New Wait Time Last 3 Months
  referral_vol_site_data_month_mshs$new_access <- waitTime_site_specialty_dept_trend_month$med_wait[match(referral_vol_site_data_month_mshs$ReceivedByDepID, waitTime_site_specialty_dept_trend_month$DepartmentId)]
  
  # New Patients Scheduled Last 3 Months
  referral_vol_site_data_month_mshs$new_14access_perc <- new_access_site_specialty_dept_month$perc_14days[match(referral_vol_site_data_month_mshs$ReceivedByDepID, new_access_site_specialty_dept_month$DepartmentId)]
  
  referral_vol_site_data_month_mshs$ReceivedByDepID <- NULL
  
  return(referral_vol_site_data_month_mshs)
  
}
  

# Site Breakdown Function Last and Current Year --------------------------------
received_vol_site_month <- function(site, monthYear, yearMonth){
  
  # site <- "MSBI"
  # monthYear <- full_monthYear
  # yearMonth <- full_yearMonth
  # 
  #  monthYear <- current_monthYear
  # yearMonth <- current_yearMonth

  # Referrals Data 
  referral_vol_site_data_month <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(ReceivedBySite == site) %>%
    filter(createdMonthYear == monthYear) %>%
    group_by(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  

  # Add Missing ApptStatusFinal
  nms <- c("ReferredToDepartmentSpecialty", "ReceivedByDept", "ReceivedByDepID", 
          "Pending", "Arrived", "Canceled", "Scheduled", "No Show")   # Vector of columns you want in this data.frame
  
  Missing <- setdiff(nms, names(referral_vol_site_data_month))  # Find names of missing columns
  referral_vol_site_data_month[Missing] <- 0                    # Add them, filled with '0's
  referral_vol_site_data_month <- referral_vol_site_data_month[nms]     
  
  
  referral_vol_site_data_month <- referral_vol_site_data_month %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  
  # Scheduling Data Filtered to Full/Current Month 
  volume_site_specialty_dept_month <- volume_site_specialty_dept_trend %>% filter(Appt.MonthYear == yearMonth)
  waitTime_site_specialty_dept_trend_month <- waitTime_site_specialty_dept_trend %>% filter(Appt.Made.MonthYear == yearMonth)
  new_access_site_specialty_dept_month <- new_access_site_specialty_dept_trend %>% filter(Appt.Made.MonthYear == yearMonth)
  
  
  # Volume Last 3 Months
  referral_vol_site_data_month$total_vol <- volume_site_specialty_dept_month$total[match(referral_vol_site_data_month$ReceivedByDepID, volume_site_specialty_dept_month$DepartmentId)]
  
  referral_vol_site_data_month <- referral_vol_site_data_month %>%
    adorn_totals("row", name = paste(site, "Total")) %>%
    mutate(conversion_rate = round((Total - Pending)/Total,2),
           completion_rate = round(Arrived/Total,2)) %>%
    dplyr::select(ReferredToDepartmentSpecialty, ReceivedByDept, ReceivedByDepID, Total, Arrived,  Pending, conversion_rate, completion_rate, total_vol)
  
  
  # New PT Volume Last 3 Months
  referral_vol_site_data_month$new_pts <- volume_site_specialty_dept_month$new_perc[match(referral_vol_site_data_month$ReceivedByDepID, volume_site_specialty_dept_month$DepartmentId)]
  
  # Median New Wait Time Last 3 Months
  referral_vol_site_data_month$new_access <- waitTime_site_specialty_dept_trend_month$med_wait[match(referral_vol_site_data_month$ReceivedByDepID, waitTime_site_specialty_dept_trend_month$DepartmentId)]
  
  # New Patients Scheduled Last 3 Months
  referral_vol_site_data_month$new_14access_perc <- new_access_site_specialty_dept_month$perc_14days[match(referral_vol_site_data_month$ReceivedByDepID, new_access_site_specialty_dept_month$DepartmentId)]
  
  referral_vol_site_data_month$ReceivedByDepID <- NULL
  
  return(referral_vol_site_data_month)
  }


## Referrals by Sending Dept ----------------------------------------------------
sending_vol_site_month <- function(site, monthYear, yearMonth){
  
  # site <- "MSHP"
  # Referrals Data 
  
  # monthYear <- current_monthYear
  # yearMonth <- "2023-01"
  
  referral_sending_vol_site_data_month <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(SentBySite != "*Unspecified") %>%
    filter(SentBySpecialty != "*Unspecified") %>%
    filter(SentBySite == site) %>%
    filter(createdMonthYear == monthYear) %>%
    # filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
    group_by(SentBySpecialty, SentByDept, SentByDepID, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  referral_sending_vol_site_data_month <- referral_sending_vol_site_data_month %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  
  # Total Visit Volume 
  volume_yearMonth <- volume_site_specialty_dept_trend %>%
    filter(Appt.MonthYear == yearMonth)
  
  referral_sending_vol_site_data_month$total_vol <- volume_yearMonth$total[match(referral_sending_vol_site_data_month$SentByDepID, volume_yearMonth$DepartmentId)]
  referral_sending_vol_site_data_month$total_vol[is.na(referral_sending_vol_site_data_month$total_vol)] <- 0
  
  referral_sending_vol_site_data_month <- referral_sending_vol_site_data_month %>%
    adorn_totals("row", name = paste(site, "Total"))
    
  referral_sending_vol_site_data_month <- referral_sending_vol_site_data_month %>%
    mutate(avg_referrals = round(Total/total_vol,2),
           conversion_rate = round((Total - Pending)/Total,2),
           completion_rate = round(Arrived/Total,2)) %>%
    dplyr::select(SentBySpecialty, SentByDept, SentByDepID, Total, Arrived,  Pending, total_vol, avg_referrals, conversion_rate, completion_rate)
  
 referral_sending_vol_site_data_month$SentByDepID <- NULL
  
  return(referral_sending_vol_site_data_month)
}

```


```{r Referrals Receievd by Month, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12}

# MSHS -------------------------------------------------------------------------
mshs_sites <- c("MSBI", "MSDMG", "MSH- Ambulatory Care", "MSH-MSDFP", 
                         "MSM", "MSUS", "MSW", "Network", "Oncology")


  # Referrals Data by Month
  referral_vol_specialty_data_mshs_trend <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(ReceivedBySite %in% mshs_sites) %>%
    filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
    group_by(ReferredToDepartmentSpecialty, createdMonthYear, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  referral_vol_specialty_data_mshs_trend <- referral_vol_specialty_data_mshs_trend %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  referral_vol_specialty_data_mshs_trend <- referral_vol_specialty_data_mshs_trend %>%
    group_by(createdMonthYear) %>%
    mutate(ReferredToDepartmentSpecialty = paste0("MSHS ",ReferredToDepartmentSpecialty)) %>%
    bind_rows(summarise(.,
                      across(where(is.integer), sum),
                      across(where(is.character), ~"*MSHS All Specialties"))) %>%
    mutate(conversion_rate = round((Total - Pending)/Total,2)*100,
           completion_rate = round(Arrived/Total,2)*100) %>%
    dplyr::select(ReferredToDepartmentSpecialty, createdMonthYear, Total, Arrived,  Pending, conversion_rate, completion_rate)
  
  referral_vol_specialty_data_mshs_trend <- referral_vol_specialty_data_mshs_trend %>%
    mutate(createdMonthYear = format(as.yearmon(createdMonthYear, "%m-%Y"),"%Y-%m")) %>%
    arrange(createdMonthYear) %>%
    arrange(ReferredToDepartmentSpecialty) 
  
  
  
referral_vol_specialty_data_site_trend <- function(site){
  
  # site <- "MSUS"
  # Referrals Data by Month
  referral_vol_specialty_data_site_trend <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(ReceivedBySite %in% site) %>%
    filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
    group_by(ReferredToDepartmentSpecialty, createdMonthYear, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  referral_vol_specialty_data_site_trend <- referral_vol_specialty_data_site_trend %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  referral_vol_specialty_data_site_trend <- referral_vol_specialty_data_site_trend %>%
    group_by(createdMonthYear) %>%
    mutate(ReferredToDepartmentSpecialty = paste0(site, " ", ReferredToDepartmentSpecialty)) %>%
    bind_rows(summarise(.,
                      across(where(is.integer), sum),
                      across(where(is.character), ~ paste0("*",site, " All Specialties")))) %>%
    mutate(conversion_rate = round((Total - Pending)/Total,2)*100,
           completion_rate = round(Arrived/Total,2)*100) %>%
    dplyr::select(ReferredToDepartmentSpecialty, createdMonthYear, Total, Arrived,  Pending, conversion_rate, completion_rate)
  
  referral_vol_specialty_data_site_trend <- referral_vol_specialty_data_site_trend %>%
    mutate(createdMonthYear = format(as.yearmon(createdMonthYear, "%m-%Y"),"%Y-%m")) %>%
    arrange(createdMonthYear) %>%
    arrange(ReferredToDepartmentSpecialty) 
}


referral_sending_vol_specialty_data_site_trend <- function(site){
  
  # site <- "MSUS"
  # Referrals Data by Month
  referral_sending_vol_specialty_data_site_trend <- referral_vol %>%
    filter(ReceivedByDept != "*Unspecified") %>%
    filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
    filter(SentBySite != "*Unspecified") %>%
    filter(SentBySpecialty != "*Unspecified") %>%
    filter(SentBySite == site) %>%
    filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
    group_by(SentBySpecialty, createdMonthYear, ApptStatusFinal) %>%
    summarise(total_vol = n()) %>%
    pivot_wider(names_from = ApptStatusFinal,
                values_from = total_vol,
                values_fill = 0) 
  
  referral_sending_vol_specialty_data_site_trend <- referral_sending_vol_specialty_data_site_trend %>%
    mutate(Total = sum(across(where(is.numeric)))) 
  
  
  volume_yearMonth <- volume_site_specialty_dept_trend %>%
    filter(Campus == site) %>%
    group_by(Campus.Specialty, Appt.MonthYear) %>%
    summarise(total_vol = sum(total)) %>%
    mutate(Appt.MonthYear = format(as.Date(paste0(Appt.MonthYear,"-01")), "%m-%Y")) %>%
    rename(createdMonthYear = Appt.MonthYear,
           SentBySpecialty = Campus.Specialty)
  
  
  referral_sending_vol_specialty_data_site_trend <- left_join(referral_sending_vol_specialty_data_site_trend, volume_yearMonth, by = c("SentBySpecialty","createdMonthYear"))
  referral_sending_vol_specialty_data_site_trend$total_vol[is.na(rreferral_sending_vol_specialty_data_site_trend$total_vol)] <- 0

  referral_sending_vol_specialty_data_site_trend <- referral_sending_vol_specialty_data_site_trend %>%
    group_by(createdMonthYear) %>%
    mutate(SentBySpecialty = paste0(site, " ", SentBySpecialty)) %>%
    bind_rows(summarise(.,
                      across(where(is.integer), sum),
                      across(where(is.character), ~ paste0("*",site, " All Specialties")))) %>%
    mutate(avg_referrals = round(Total/total_vol, 2),
           conversion_rate = round((Total - Pending)/Total,2)*100,
           completion_rate = round(Arrived/Total,2)*100) %>%
    dplyr::select(SentBySpecialty, createdMonthYear, Total, Arrived,  Pending, avg_referrals, conversion_rate, completion_rate)
  
  referral_sending_vol_specialty_data_site_trend <- referral_sending_vol_specialty_data_site_trend %>%
    mutate(createdMonthYear = format(as.yearmon(createdMonthYear, "%m-%Y"),"%Y-%m")) %>%
    arrange(createdMonthYear) %>%
    arrange(SentBySpecialty) 
}
  
```


```{r Referrals Lead Days to Scheduling by Month, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12}

# MSHS -------------------------------------------------------------------------
# mshs_sites <- c("MSBI", "MSDMG", "MSH- Ambulatory Care", "MSH-MSDFP", 
#                          "MSM", "MSUS", "MSW", "Network", "Oncology")
# 
# 
#   # Referrals Data by Month
#   referral_received_specialty_data_mshs_trend <- referral_vol %>%
#     filter(ReceivedByDept != "*Unspecified") %>%
#     filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
#     filter(ReceivedBySite %in% mshs_sites) %>%
#     filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
#     group_by(ReferredToDepartmentSpecialty, createdMonthYear) %>%
#     summarise(total_received = n()) %>%
#     mutate(yearMonth = format(as.yearmon(createdMonthYear, "%m-%Y"),"%Y-%m"))
#   
#   referral_scheduled_specialty_data_mshs_trend <- referral_vol %>%
#     filter(ReceivedByDept != "*Unspecified") %>%
#     filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
#     filter(ReceivedBySite %in% mshs_sites) %>%
#     filter(first_appt_created < report_run_date & first_appt_created >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
#     group_by(ReferredToDepartmentSpecialty, scheduledYearMonth) %>%
#     summarise(total_scheduled = n()) %>%
#     rename(yearMonth = scheduledYearMonth)
#   
#   referral_leadDays_specialty_data_mshs_trend <- referral_vol %>%
#     filter(ReceivedByDept != "*Unspecified") %>%
#     filter(ReferredToDepartmentSpecialty != "*Unspecified") %>%
#     filter(ReceivedBySite %in% mshs_sites) %>%
#     filter(StartInstant < report_run_date & StartInstant >= as.Date("2022-09-01", "%Y-%m-%d")) %>%
#     group_by(ReferredToDepartmentSpecialty, scheduledYearMonth) %>%
#     summarise(leadDays= median(leadDays, na.rm = TRUE)) %>%
#     rename(yearMonth = scheduledYearMonth)
#   
#   
#   #put all data frames into list
#   df_list <- list(referral_received_specialty_data_mshs_trend,
#                   referral_scheduled_specialty_data_mshs_trend,
#                   referral_leadDays_specialty_data_mshs_trend)
#   
#   #merge all data frames together
#   referral_leadDays_specialty_data_mshs_trend_merged <- Reduce(function(x, y) merge(x, y, all=TRUE), df_list)  


```


# Ambulatory Referrals Summary
*Report Run Date: `r report_run_date`*<br/>
*Data Date Range: From 2022-09-01 to `r report_run_date - 1`*<br/>
*Data Source: EPIC Caboodle Referrals Data and Clarity Scheduling Data*<br/>
**MSHS does not include MSHP as receiving site**<br/>

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
<span style='font-size: 18px;; color: #d80b8c'>**Metric Definitions:**</span>
:::
<span style='font-size: 16px;'>-- **Referrals Unassigned:** Total referrals with **no visits linked**</span><br/>
<span style='font-size: 16px;'>-- **Avg Referrals Sent per Visit:** Total referrals sent over total visits completed</span><br/>
<span style='font-size: 16px;'>-- **Conversion Rate:** Total referrals with **scheduled visits** over total referrals received</span><br/>
<span style='font-size: 16px;'>-- **Completion Rate:** Total referrals with **arrived visits** over total referrals received</span><br/>
<br/>
<span style='font-size: 16px; color: #FF0000'>**This report may take a few seconds to load**</span>
::::

<!-- ## Referrals Summary -->
```{r All Referrals Summary,  echo = FALSE, warning = FALSE, message = FALSE, fig.width=12}



```


## MSHS* {.tabset .tabset-fade .tabset-pills}
### Sep 2022-`r reporting_year` YTD
```{r MSHS Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12}
htmltools::browsable(
  tagList(
    # tags$button(
    #   "Expand/collapse all",
    #   onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-mshs')"
    # ),
    tags$button(
      tagList(fontawesome::fa("download"), "Download Monthly Volume by Site"),
      onclick = "Reactable.downloadDataCSV('referral-vol-download-table', 'Monthly Volume Data')"
    ),

reactable(
  referral_vol_site_data_mshs,
  # elementId = "referrals-expansion-table-mshs-1",
  elementId = "referral-vol-download-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  # RowStyle = function(index) {
  #           if (index %in% c(nrow(referral_vol_site_data_mshs))) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    # height = 800,
    wrap = TRUE,
  searchable = TRUE,

  groupBy = "ReferredToDepartmentSpecialty",

  columnGroups = list(
    colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"),
             headerStyle = list(color = "black", fontSize = "15px"),
             sticky = "left"),
    colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"),
             headerStyle = list(color = "#210070", fontSize = "15px")),
    colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"),
              headerStyle = list(color = "#00aeef", fontSize = "15px"))
    ),

  columns = list(

    ReferredToDepartmentSpecialty = colDef(
      # footer = "Total",
      name = "Specialty (# of Departments)",
      minWidth = 180),

    ReceivedByDept = colDef(
      name = "Department",
      minWidth = 250),

    Total = colDef(
      name = "Total Referrals Received",
      maxWidth = 100,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = "sum",
      # footer = JS("function(column, state) {
      #   let total = 0
      #   state.sortedData.forEach(function(row) {
      #     total += row[column.id]
      #   })
      #   return total.toFixed(0)
      # }"),
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    Arrived = colDef(
      name = "Referrals with Completed Appointments",
      maxWidth = 100,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = "sum",
      # footer = JS("function(column, state) {
      #   let total = 0
      #   state.sortedData.forEach(function(row) {
      #     total += row[column.id]
      #   })
      #   return total.toFixed(0).toLocaleString()
      # }"),
      format = colFormat(separators = TRUE, digits = 0)
    ),

    Pending = colDef(
      name = "Referrals Unassigned",
      maxWidth = 100,
      headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = "sum",
      # footer = JS("function(column, state) {
      #   let total = 0
      #   state.sortedData.forEach(function(row) {
      #     total += row[column.id]
      #   })
      #   return total.toFixed(0)
      # }"),
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderRight = "1.5px solid rgb(230, 230, 230)")
    ),

    conversion_rate = colDef(
      name = "Conversion Rate",
      maxWidth = 100,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # Calculate the aggregate conversion rate as `(total-pending) / total`
      aggregate = JS("function(values, rows) {
        let totalPending = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalTotal += row['Total']
          totalPending += row['Pending']
        })
        return (totalTotal - totalPending) / totalTotal
      }"),
      style = JS("function(rowInfo) {
        var value = rowInfo.row['conversion_rate']
        if (value > 0.5) {
          var color = '#008000'
        } else if (value <= 0.5 ) {
          var color = '#e00000'
        } else {
          var color = '#000000'
        }
        return { color: color, fontFamily: 'calibri', fontWeight: 'bold'}
      }"),
      format = colFormat(percent = TRUE, digits = 0)
    ),

    completion_rate = colDef(
      name = "Completion Rate",
      maxWidth = 100,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # Calculate the aggregate conversion rate as `(total-pending) / total`
      aggregate = JS("function(values, rows) {
        let totalArrived = 0
        let totalTotal = 0
        rows.forEach(function(row) {
          totalTotal += row['Total']
          totalArrived += row['Arrived']
        })
        return totalArrived / totalTotal
      }"),
      style = JS("function(rowInfo) {
        var value = rowInfo.row['completion_rate']
        if (value > 0.5) {
          var color = '#008000'
        } else if (value <= 0.5 ) {
          var color = '#e00000'
        } else {
          var color = '#000000'
        }
        return { color: color, fontFamily: 'calibri', fontWeight: 'bold'}
      }"),
      format = colFormat(percent = TRUE, digits = 0)
    ),

    total_vol = colDef(
      name = "Total Volume",
      maxWidth = 100,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = "sum",
      # footer = JS("function(column, state) {
      #   let total = 0
      #   state.sortedData.forEach(function(row) {
      #     total += row[column.id]
      #   })
      #   return total.toFixed(0)
      # }"),
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    new_pts = colDef(
      name = "% New Visits",
      maxWidth = 100,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = "sum",
      # footer = JS("function(column, state) {
      #   let total = 0
      #   state.sortedData.forEach(function(row) {
      #     total += row[column.id]
      #   })
      #   return total.toFixed(0)
      # }"),
      format = colFormat(percent = TRUE, digits = 0)
    ),

    new_access = colDef(
      name = "Median New Wait Time",
      maxWidth = 100,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = "sum",
      # footer = JS("function(column, state) {
      #   let total = 0
      #   state.sortedData.forEach(function(row) {
      #     total += row[column.id]
      #   })
      #   return total.toFixed(0)
      # }"),
      format = colFormat(separators = TRUE, digits = 0, suffix = " days")
    ),

    new_14access_perc = colDef(
      name = "% New Patients Scheduled <14 Days",
      maxWidth = 100,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      # aggregate = "sum",
      # footer = JS("function(column, state) {
      #   let total = 0
      #   state.sortedData.forEach(function(row) {
      #     total += row[column.id]
      #   })
      #   return total.toFixed(0)
      # }"),
      format = colFormat(percent = TRUE, digits = 0)
    )

  ) # Close Columns

  ) # Close Reactable

 )
)

```
<br/>
<br/>


<!-- ### `r full_monthYear_label` -->
<!-- ```{r MSHS Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-mshs-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   referral_vol_site_data_mshs_month(full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-mshs-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### `r current_monthYear_label` MTD -->
<!-- ```{r MSHS Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-mshs-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   referral_vol_site_data_mshs_month(current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-mshs-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Trend -->
<!-- ```{r MSHS Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- map(unique(referral_vol_specialty_data_mshs_trend$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (referral_vol_specialty_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (referral_vol_specialty_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (referral_vol_specialty_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (referral_vol_specialty_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- # map(unique(referral_vol_specialty_data_mshs_trend$ReferredToDepartmentSpecialty), function(x){ -->
<!-- # highchart() %>% -->
<!-- #   hc_yAxis_multiples( -->
<!-- #     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!-- #     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!-- #            labels = list(format = '{value}%'), -->
<!-- #            showLastLabel = FALSE, opposite = TRUE) -->
<!-- #   ) %>% -->
<!-- #   hc_xAxis(title = list(text = ""), -->
<!-- #            categories = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!-- #            type = "datetime", -->
<!-- #            labels = list(format = '{value:%m/%d}') -->
<!-- #            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!-- #            ) %>% -->
<!-- #   hc_add_series(name   = "Total Referrals Received", -->
<!-- #                 data   = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!-- #                 type = "column", -->
<!-- #                                 zones = list(list(value = 0, -->
<!-- #                                   color = 'red')), -->
<!-- #                 color='#a5a7a5', -->
<!-- #                 marker = list(enabled= TRUE), -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name   = "MSDMG", -->
<!-- #                 data   = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "MSDMG"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name   = "MSH- Ambulatory Care", -->
<!-- #                 data   = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "MSH- Ambulatory Care"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name   = "MSH-MSDFP", -->
<!-- #                 data   = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "MSH-MSDFP"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name   = "MSM", -->
<!-- #                 data   = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "MSM"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name   = "MSUS", -->
<!-- #                 data   = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "MSUS"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name = "MSW", -->
<!-- #                 data   = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "MSW"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name = "Network", -->
<!-- #                 data = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "Network"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_add_series(name = "Oncology", -->
<!-- #                 data = (referral_vol_site_data_mshs_trend %>% filter(ReferredToDepartmentSpecialty == x) %>% filter(ReceivedBySite == "Oncology"))$conversion_rate, -->
<!-- #                  marker = list(enabled= TRUE), yAxis = 1, -->
<!-- #                 color='#d80b8c', -->
<!-- #                 lineWidth=3, -->
<!-- #                 lineColor='#d80b8c', -->
<!-- #                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!-- #                 ) %>% -->
<!-- #   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!-- #     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!-- #     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!-- #     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!-- #     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!-- #   }) %>% -->
<!-- #   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->



<!-- ## MSBI  -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSBI Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msbi')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSBI"), -->
<!--   elementId = "referrals-sending-expansion-table-msbi", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSBI Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msbi-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSBI", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msbi-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSBI Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msbi-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSBI", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msbi-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSBI Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msbi')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSBI"), -->
<!--   elementId = "referrals-expansion-table-msbi", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSBI Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msbi-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSBI", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msbi-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSBI Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msbi-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSBI", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msbi-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### Trend -->
<!-- ```{r MSBI Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("MSBI") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->


<!-- ## MSDMG  -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSDMG Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msdmg')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSDMG"), -->
<!--   elementId = "referrals-sending-expansion-table-msdmg", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSDMG Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msdmg-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSDMG", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msdgm-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSDMG Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msdmg-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSDMG", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msdmg-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSDMG Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msdmg')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSDMG"), -->
<!--   elementId = "referrals-expansion-table-msdmg", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSDMG Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msdmg-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSDMG", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msdmg-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSDMG Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msdmg-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSDMG", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msdmg-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->

<!-- #### Trend -->
<!-- ```{r MSDMG Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("MSDMG") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->


<!-- ## MSH- Ambulatory Care  -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSH- Ambulatory Care Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msh-amb')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSH- Ambulatory Care"), -->
<!--   elementId = "referrals-sending-expansion-table-msh-amb", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSH- Ambulatory Care Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msh-amb-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSH- Ambulatory Care", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msh-amb-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSH- Ambulatory Care Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msh-amb-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSH- Ambulatory Care", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msh-amb-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSH- Ambulatory Care Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msh-amb')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSH- Ambulatory Care"), -->
<!--   elementId = "referrals-expansion-table-msh-amb", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSH- Ambulatory Care Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msh-amb-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSH- Ambulatory Care", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msh-amb-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSH- Ambulatory Care Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msh-amb-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSH- Ambulatory Care", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msh-amb-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ## MSH-MSDFP  -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSH-MSDFP Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msh-msdfp')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSH-MSDFP"), -->
<!--   elementId = "referrals-sending-expansion-table-msh-msdfp", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSH-MSDFP Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msh-msdfp-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSH-MSDFP", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msh-msdfp-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSH-MSDFP Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msh-msdfp-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSH-MSDFP", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msh-msdfp-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSH-MSDFP Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msh-msdfp')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSH-MSDFP"), -->
<!--   elementId = "referrals-expansion-table-msh-msdfp", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSH-MSDFP Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msh-msdfp-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSH-MSDFP", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msh-msdfp-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSH-MSDFP Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msh-msdfp-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSH-MSDFP", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msh-msdfp-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### Trend -->
<!-- ```{r MSH-MSDFP Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("MSH-MSDFP") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->


<!-- ## MSM  -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSM Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msm')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSM"), -->
<!--   elementId = "referrals-sending-expansion-table-msm", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSM Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msm-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSM", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msm-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSM Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msm-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSM", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msm-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSM Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msm')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSM"), -->
<!--   elementId = "referrals-expansion-table-msm", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSM Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msm-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSM", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msm-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSM Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msm-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSM", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msm-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### Trend -->
<!-- ```{r MSM Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("MSM") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->


<!-- ## MSUS -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSUS Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msus')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSUS"), -->
<!--   elementId = "referrals-sending-expansion-table-msus", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSUS Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msus-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSUS", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msus-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSUS Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msus-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSUS", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msus-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSUS Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msus')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSUS"), -->
<!--   elementId = "referrals-expansion-table-msus", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSUS Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msus-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSUS", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msus-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSUS Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msus-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSUS", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msus-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### Trend -->
<!-- ```{r MSUS Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("MSUS") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->


<!-- ## MSW -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSW Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msw')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSW"), -->
<!--   elementId = "referrals-sending-expansion-table-msw", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSW Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msw-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSW", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msw-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSW Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-msw-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSW", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-msw-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSW Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msw')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSW"), -->
<!--   elementId = "referrals-expansion-table-msw", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->
<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSW Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msw-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSW", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msw-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSW Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-msw-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSW", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-msw-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### Trend -->
<!-- ```{r MSW Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("MSW") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->


<!-- ## Network  -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r Network Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-network')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("Network"), -->
<!--   elementId = "referrals-sending-expansion-table-network", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r Network Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-network-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("Network", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-network-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r Network Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-network-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("Network", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-network-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r Network Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-network')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("Network"), -->
<!--   elementId = "referrals-expansion-table-network", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->
<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r Network Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-network-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("Network", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-network-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r Network Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-network-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("Network", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-network-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### Trend -->
<!-- ```{r Network Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("Network") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->


<!-- ## Oncology  -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r Oncology Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-oncology')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("Oncology"), -->
<!--   elementId = "referrals-sending-expansion-table-oncology", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r Oncology Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-oncology-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("Oncology", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-oncology-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r Oncology Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-oncology-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("Oncology", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-oncology-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Receieved {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r Oncology Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-oncology')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("Oncology"), -->
<!--   elementId = "referrals-expansion-table-oncology", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r Oncology Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-oncology-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("Oncology", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-oncology-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r Oncology Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-oncology-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("Oncology", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-oncology-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Trend -->
<!-- ```{r Oncology Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("Oncology") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->



<!-- ## MSHP -->
<!-- ### Referrals Sent {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSHP Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-mshp')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_ytd("MSHP"), -->
<!--   elementId = "referrals-sending-expansion-table-mshp", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     SentByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSHP Last Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-mshp-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSHP", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-mshp-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--      avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSHP Current Month Total Referrals Sent Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-sending-expansion-table-mshp-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   sending_vol_site_month("MSHP", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-sending-expansion-table-mshp-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "SentBySpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("SentBySpecialty", "SentByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Sent in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "avg_referrals", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     SentBySpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Sent", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     avg_referrals = colDef( -->
<!--       name = "Avg Referrals Sent per Visit", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalTotal = 0 -->
<!--         let totaltotal_vol = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totaltotal_vol += row['total_vol'] -->
<!--         }) -->
<!--         return (totalTotal) / totaltotal_vol -->
<!--       }"), -->
<!--       format = colFormat(separators = TRUE, digits = 1), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef(show =F) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- ### Referrals Received {.tabset .tabset-fade .tabset-pills} -->
<!-- #### Sep 2022-`r reporting_year` YTD -->
<!-- ```{r MSHP Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-mshp')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_ytd("MSHP"), -->
<!--   elementId = "referrals-expansion-table-mshp", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_week_data))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received from Sep 2022 - ",reporting_year, " YTD"), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = "Visits Arrived/Scheduled in the Last 3 Months", columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r full_monthYear_label` -->
<!-- ```{r MSHP Last Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-mshp-last')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSHP", full_monthYear, full_yearMonth), -->
<!--   elementId = "referrals-expansion-table-mshp-last", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", full_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", full_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### `r current_monthYear_label` MTD -->
<!-- ```{r MSHP Current Month Total Referrals Received Output, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->
<!-- htmltools::browsable( -->
<!--   tagList( -->
<!--     tags$button( -->
<!--       "Expand/collapse all", -->
<!--       onclick = "Reactable.toggleAllRowsExpanded('referrals-expansion-table-mshp-current')" -->
<!--     ), -->

<!-- reactable( -->
<!--   received_vol_site_month("MSHP", current_monthYear, current_yearMonth), -->
<!--   elementId = "referrals-expansion-table-mshp-current", -->
<!--   style = list(fontFamily = 'Calibri', -->
<!--                  fontSize = '14px'), -->
<!--     defaultColDef = colDef(align = "left", -->
<!--                            headerStyle = list(fontWeight = "Bold", fontSize = "14px"), -->
<!--                            headerClass = "bar-sort-header"), -->
<!--   # RowStyle = function(index) { -->
<!--   #           if (index %in% c(nrow(referral_vol_site_data_mshs))) { -->
<!--   #             list(`border-top` = "2px solid rgb(184,184,184)", -->
<!--   #                  fontWeight = "Bold") -->
<!--   #           } -->
<!--   #         }, -->
<!--     highlight = TRUE, -->
<!--     # filterable = TRUE, -->
<!--     pagination = FALSE, -->
<!--     # height = 800, -->
<!--     wrap = TRUE, -->
<!--   searchable = TRUE, -->

<!--   groupBy = "ReferredToDepartmentSpecialty", -->

<!--   columnGroups = list( -->
<!--     colGroup(name = "", columns = c("ReferredToDepartmentSpecialty", "ReceivedByDept"), -->
<!--              headerStyle = list(color = "black", fontSize = "15px"), -->
<!--              sticky = "left"), -->
<!--     colGroup(name = paste0("Referrals Received in ", current_monthYear_label), columns = c("Total", "Arrived", "Pending", "conversion_rate", "completion_rate"), -->
<!--              headerStyle = list(color = "#210070", fontSize = "15px")), -->
<!--     colGroup(name = paste0("Visits Arrived/Scheduled in ", current_monthYear_label), columns = c("total_vol", "new_pts", "new_access", "new_14access_perc"), -->
<!--               headerStyle = list(color = "#00aeef", fontSize = "15px")) -->
<!--     ), -->

<!--   columns = list( -->

<!--     ReferredToDepartmentSpecialty = colDef( -->
<!--       # footer = "Total", -->
<!--       name = "Specialty (# of Departments)", -->
<!--       minWidth = 180), -->

<!--     ReceivedByDept = colDef( -->
<!--       name = "Department", -->
<!--       minWidth = 250), -->

<!--     Total = colDef( -->
<!--       name = "Total Referrals Received", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     Arrived = colDef( -->
<!--       name = "Referrals with Completed Appointments", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0).toLocaleString() -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0) -->
<!--     ), -->

<!--     Pending = colDef( -->
<!--       name = "Referrals Unassigned", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#210070", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderRight = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     conversion_rate = colDef( -->
<!--       name = "Conversion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalPending = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalPending += row['Pending'] -->
<!--         }) -->
<!--         return (totalTotal - totalPending) / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['conversion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     completion_rate = colDef( -->
<!--       name = "Completion Rate", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # Calculate the aggregate conversion rate as `(total-pending) / total` -->
<!--       aggregate = JS("function(values, rows) { -->
<!--         let totalArrived = 0 -->
<!--         let totalTotal = 0 -->
<!--         rows.forEach(function(row) { -->
<!--           totalTotal += row['Total'] -->
<!--           totalArrived += row['Arrived'] -->
<!--         }) -->
<!--         return totalArrived / totalTotal -->
<!--       }"), -->
<!--       style = JS("function(rowInfo) { -->
<!--         var value = rowInfo.row['completion_rate'] -->
<!--         if (value > 0.5) { -->
<!--           var color = '#008000' -->
<!--         } else if (value <= 0.5 ) { -->
<!--           var color = '#e00000' -->
<!--         } else { -->
<!--           var color = '#000000' -->
<!--         } -->
<!--         return { color: color, fontFamily: 'calibri', fontWeight: 'bold'} -->
<!--       }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     total_vol = colDef( -->
<!--       name = "Total Volume", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0), -->
<!--       style = list(borderLeft = "1.5px solid rgb(230, 230, 230)") -->
<!--     ), -->

<!--     new_pts = colDef( -->
<!--       name = "% New Visits", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ), -->

<!--     new_access = colDef( -->
<!--       name = "Median New Wait Time", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(separators = TRUE, digits = 0, suffix = " days") -->
<!--     ), -->

<!--     new_14access_perc = colDef( -->
<!--       name = "% New Patients Scheduled <14 Days", -->
<!--       maxWidth = 100, -->
<!--       headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"), -->
<!--       # aggregate = "sum", -->
<!--       # footer = JS("function(column, state) { -->
<!--       #   let total = 0 -->
<!--       #   state.sortedData.forEach(function(row) { -->
<!--       #     total += row[column.id] -->
<!--       #   }) -->
<!--       #   return total.toFixed(0) -->
<!--       # }"), -->
<!--       format = colFormat(percent = TRUE, digits = 0) -->
<!--     ) -->

<!--   ) # Close Columns -->

<!--   ) # Close Reactable -->

<!--  ) -->
<!-- ) -->

<!-- ``` -->
<!-- <br/> -->
<!-- <br/> -->


<!-- #### Trend -->
<!-- ```{r MSHP Conversion Rate Trend, echo = FALSE, warning = FALSE, message = FALSE, fig.width=12} -->

<!-- data <- referral_vol_specialty_data_site_trend("MSHP") -->

<!-- map(unique(data$ReferredToDepartmentSpecialty), function(x){ -->
<!-- highchart() %>% -->
<!--   hc_yAxis_multiples( -->
<!--     list(title = list(text = "# of Referrals"), lineWidth = 3, min = 0), -->
<!--     list(title = list(text = "% of Referrals Received"), min = -50,max=200, -->
<!--            labels = list(format = '{value}%'), -->
<!--            showLastLabel = FALSE, opposite = TRUE) -->
<!--   ) %>% -->
<!--   hc_xAxis(title = list(text = ""), -->
<!--            categories = (data %>% filter(ReferredToDepartmentSpecialty == x))$createdMonthYear, -->
<!--            type = "datetime", -->
<!--            labels = list(format = '{value:%Y/%m}') -->
<!--            # dateTimeLabelFormats = list(month = '%Y-%m') -->
<!--            ) %>% -->
<!--   hc_add_series(name   = "Total Referrals Received", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$Total, -->
<!--                 type = "column", -->
<!--                                 zones = list(list(value = 0, -->
<!--                                   color = 'red')), -->
<!--                 color='#a5a7a5', -->
<!--                 marker = list(enabled= TRUE), -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}') -->
<!--                 ) %>% -->
<!--   hc_add_series(name   = "Conversion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$conversion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#00aeef', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#00aeef', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--    hc_add_series(name   = "Completion Rate", -->
<!--                 data   = (data %>% filter(ReferredToDepartmentSpecialty == x))$completion_rate, -->
<!--                  marker = list(enabled= TRUE), yAxis = 1, -->
<!--                 color='#d80b8c', -->
<!--                 lineWidth=3, -->
<!--                 lineColor='#d80b8c', -->
<!--                 dataLabels = list(enabled = TRUE, format='{point.y}%') -->
<!--                 ) %>% -->
<!--   hc_legend(align = "left", verticalAlign = "top", itemStyle = list(fontFamily ='Calibri',color ='black', fontSize = "14px")) %>% -->
<!--     hc_title(text = paste0(x, " - Referrals Outcome"), align = "left", style = list(fontWeight = 'bold', fontSize = "22px", fontFamily = "Calibri")) %>% -->
<!--     # hc_subtitle(text = paste0("Includes Radiology and Rad Onc visits up to ",radiology_date,"<br> Based on visits from ",date_start," to ",date_end), -->
<!--     #           align = "left", style = list(fontFace = "italic", fontSize = "16px", fontFamily = "Calibri")) %>% -->
<!--     hc_tooltip(shared = TRUE, borderColor = "black") -->
<!--   }) %>% -->
<!--   hw_grid(ncol = 2, rowheight = 400) %>% htmltools::browsable() -->

<!-- ``` -->

